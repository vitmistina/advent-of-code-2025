# Implementation Plan: AoC Day 8 Part 2 - Complete Circuit Formation

**Branch**: `017-day-08-part-2` | **Date**: December 10, 2025 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/017-day-08-part-2/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

**Primary Requirement**: Find the specific pair of junction boxes whose connection completes circuit unification (all boxes in one circuit), then calculate the product of their X coordinates.

**Technical Approach**: Use classic Union-Find algorithm with path compression and union-by-rank to efficiently track circuit connectivity. Process junction box pairs in ascending distance order, checking for the transition from 2 circuits to 1 circuit. This approach provides O(N² log N) complexity versus O(N³) for the dictionary-based approach from Part 1, yielding ~125x performance improvement for the ~500k membership checks required.

## Technical Context

**Language/Version**: Python 3.10+  
**Primary Dependencies**: Standard library only (math, pathlib, pytest)  
**Storage**: File-based (input.txt, test_input.txt)  
**Testing**: pytest with test-driven development (TDD) workflow  
**Target Platform**: Local development environment (cross-platform Python)  
**Project Type**: Single project - Advent of Code daily challenge  
**Performance Goals**: Complete Part 2 solution in <1 second for N=1000 junction boxes (~500k distance pairs)  
**Constraints**:

- Standard library only (no external dependencies beyond pytest for testing)
- Must reuse coordinate parsing from Part 1
- Must handle up to 1000 junction boxes (~500k pairwise distances)
  **Scale/Scope**:
- Example input: 20 junction boxes
- Full puzzle input: ~1000 junction boxes
- Processing: ~500k distance pairs to find ~999 connections

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

| Principle                               | Status  | Notes                                                                                                          |
| --------------------------------------- | ------- | -------------------------------------------------------------------------------------------------------------- |
| **I. Clean Python Code**                | ✅ PASS | Python 3.10+ with type hints, PEP8 via Ruff                                                                    |
| **II. Structured Organization**         | ✅ PASS | Solution in `day-08/solution_part2.py`, tests in `day-08/test_solution_part2.py`                               |
| **III. Function-Based Solutions**       | ✅ PASS | `solve_part2()` with docstrings, UnionFind class with documented methods                                       |
| **IV. Test-Driven Development**         | ✅ PASS | RED-GREEN-REFACTOR enforced: example test (product=25272) written first, verified to fail, then implementation |
| **V. Automation First**                 | ✅ PASS | Input already downloaded by meta runner, spec generated by Specify framework                                   |
| **VI. AoC Compliance**                  | ✅ PASS | No auto-submission, session token from .env, manual result submission                                          |
| **VII. Documentation & Progress**       | ✅ PASS | README.md update planned post-completion, research.md documents algorithm choice                               |
| **VIII. Specification-Driven Workflow** | ✅ PASS | Following spec→tasks flow, plan phase active (research complete)                                               |
| **IX. Delightful CLI**                  | ✅ PASS | Meta runner already provides scaffold/run commands with `uv run`                                               |

**Code Structure Requirements**:

- ✅ UV for dependency management
- ✅ Git commits to main branch
- ✅ Specify framework integration (`specs/017-day-08-part-2/`)
- ✅ TDD workflow (RED→GREEN→REFACTOR in tasks)

**Constitution Violations**: None

**Complexity Justification**: N/A - no deviations from constitution required

## Project Structure

### Documentation (this feature)

```text
specs/017-day-08-part-2/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command) ✓
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
day-08/
├── solution.py              # Part 1 solution (existing - reuse parsing)
├── solution_part2.py        # Part 2 solution with UnionFind (NEW)
├── test_solution.py         # Part 1 tests (existing)
├── test_solution_part2.py   # Part 2 tests (NEW)
├── input.txt                # Puzzle input (existing)
├── test_input.txt           # Example input for Part 1 (existing)
├── test_input_2.txt         # Example input for Part 2 (NEW - same as Part 1)
└── description.md           # Puzzle description (existing)

specs/017-day-08-part-2/
└── [documentation files as above]
```

**Structure Decision**: Single project structure (Advent of Code daily challenge). Part 2 solution lives in the same `day-08/` folder as Part 1, following the convention established by the constitution. Part 2 gets separate solution and test files (`solution_part2.py`, `test_solution_part2.py`) to maintain clear separation while allowing code reuse (parsing, distance calculation).

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No violations** - This feature adheres to all constitution principles without requiring complexity justification.

---

## Phase Summary

### Phase 0: Research & Outline ✅

**Completed**: Algorithm complexity analysis and decision documentation

**Key Decision**: Use classic Union-Find instead of dictionary-based approach from Part 1

**Performance Impact**: ~125x faster (4M operations vs 500M operations for ~500k membership checks)

**Artifacts**:

- ✅ `research.md` — Algorithm analysis with performance comparison

### Phase 1: Design & Contracts ✅

**Completed**: Data model and developer workflow documentation

**Artifacts**:

- ✅ `data-model.md` — UnionFind class, JunctionBox entity, algorithm invariants
- ✅ `quickstart.md` — TDD workflow, testing strategy, debugging tips
- ✅ Updated agent context (GitHub Copilot)

**Note**: No `contracts/` directory needed (not applicable for Advent of Code)

### Phase 2: Tasks (NOT COMPLETED - OUT OF SCOPE)

**Status**: Deferred to `/speckit.tasks` command

Per mode instructions: "Command ends after Phase 2 planning"

---

## Next Steps

1. **Run `/speckit.tasks` command** to generate TDD task breakdown:

   - RED tasks (write failing tests)
   - GREEN tasks (implement UnionFind, solve_part2)
   - REFACTOR tasks (optimize, lint, type-check)

2. **Execute tasks** following TDD workflow in `quickstart.md`

3. **Submit answer** manually per Constitution Principle VI

4. **Update progress tracker** in main `README.md`

---

## Branch Information

**Branch**: `017-day-08-part-2`  
**Implementation Plan**: `c:\Users\YJ42EK\coding\advent-of-code-2025\specs\017-day-08-part-2\plan.md`

**Generated Artifacts**:

- `research.md` — Algorithm decision (Union-Find vs dictionary)
- `data-model.md` — Entity definitions and data flow
- `quickstart.md` — Developer workflow guide
- Updated `.github/agents/copilot-instructions.md`

**Constitution Compliance**: ✅ All principles satisfied, no violations
